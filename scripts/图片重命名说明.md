# 图片自动重命名功能说明

## 📋 功能概述

这个自动重命名系统可以：
1. ✅ 自动识别包含中文、特殊字符或URL编码的图片文件名
2. ✅ 将文件名重命名为友好的英文名称（便于下载和分享）
3. ✅ 自动更新所有HTML文件中的图片引用路径
4. ✅ 保存重命名映射，避免重复处理
5. ✅ 支持增量处理，不影响已重命名的文件
6. ✅ **新添加的Obsidian图片会自动重命名**（集成到部署流程中）

## 🚀 使用方法

### 方法一：手动运行重命名脚本（批量处理已有文件）

```bash
cd "/Users/qianny/Nutstore Files/ThinkingLeafSpace 20250704com/ThinkingLeafSpace 20250924com"
python3 scripts/rename_images.py
```

这会：
- 扫描 `images/blog/` 目录下所有需要重命名的图片
- 重命名文件并保存映射
- 更新所有HTML文件中的引用路径

### 方法二：自动重命名（新图片自动处理）

**无需手动操作！** 

当你使用 `deploy_blog.sh` 部署新博客时，如果图片文件名包含中文或特殊字符，系统会**自动重命名**：

```bash
./scripts/deploy_blog.sh "/path/to/你的文章.md"
```

在复制图片时，如果检测到文件名需要重命名，会自动：
1. 复制图片到 `images/blog/`
2. 生成英文文件名
3. 重命名文件
4. 在HTML中使用新的英文路径

## 📁 文件说明

### `scripts/rename_images.py`
- 主重命名脚本
- 可以独立运行，批量处理所有图片

### `scripts/image_rename_mapping.json`
- 保存所有重命名映射记录
- 确保已重命名的文件不会重复处理
- 记录格式：`{"旧文件名": "新文件名"}`

### 集成到 `scripts/markdown_to_html.py`
- 在图片复制过程中自动检测并重命名
- 确保新添加的图片立即使用英文名称

## 🔄 工作流程

### 部署新博客时的流程：

```
1. Markdown文件 → HTML转换
   ↓
2. 处理图片引用
   ↓
3. 复制图片到 images/blog/
   ↓
4. 检测文件名（是否包含中文/特殊字符？）
   ├─ 否 → 直接使用原文件名
   └─ 是 → 生成英文文件名 → 重命名 → 更新HTML引用
```

### 批量重命名已有文件的流程：

```
1. 运行 rename_images.py
   ↓
2. 扫描 images/blog/ 目录
   ↓
3. 识别需要重命名的文件
   ↓
4. 生成英文文件名（基于文件名特征和日期）
   ↓
5. 重命名文件
   ↓
6. 更新所有HTML文件中的引用
   ↓
7. 保存映射到 image_rename_mapping.json
```

## 📝 重命名规则

### 命名规则示例：

| 原始文件名 | 新文件名 | 说明 |
|-----------|---------|------|
| `微信图片_20250414225738.jpg` | `workshop-notes-20250414.jpg` | 识别关键词 + 日期 |
| `笔记.png` | `workshop-lecture-notes-20250415.png` | 根据上下文添加日期 |
| `IMG-2025-04-17 或许设计实验就是容易失败，对吗？-${date}.png` | `design-experiment-poster-2025-04-17.png` | 预定义映射 |
| `创造/存档/半载观想小记：在大理、在内观禅修的路上 e5a46807926c4e7cb754455e185074a6/Untitled.png` | `meditation-schedule-20240706.png` | 扁平化目录结构 |

### 命名原则：

1. **英文名称**：只使用英文字母、数字、连字符
2. **有意义的描述**：包含关键词（workshop, meditation, notes等）
3. **日期信息**：如果原文件名包含日期，会保留在新文件名中
4. **唯一性**：如果文件名冲突，会自动添加数字后缀

## ✅ 优势

- ✅ **下载友好**：用户下载图片时得到清晰的英文文件名
- ✅ **URL兼容**：避免中文和特殊字符导致的URL编码问题
- ✅ **不会重复处理**：已重命名的文件会记录在映射表中，不会重复处理
- ✅ **自动集成**：新图片自动重命名，无需手动操作
- ✅ **向后兼容**：已存在的图片和HTML引用会自动更新

## 🔍 检查重命名状态

查看映射文件：
```bash
cat scripts/image_rename_mapping.json
```

检查是否有需要重命名的文件：
```bash
python3 scripts/rename_images.py
```

## ⚠️ 注意事项

1. **备份重要**：虽然脚本会自动更新引用，但建议先备份重要文件
2. **可以重复运行**：脚本可以安全地重复运行，不会重复处理已重命名的文件
3. **映射文件**：`image_rename_mapping.json` 记录了所有重命名，不要手动删除
4. **嵌套目录**：嵌套在 `创造/存档/...` 中的文件会被移到主目录并重命名

## 🛠️ 故障排除

### 如果重命名失败：

1. 检查文件权限：确保脚本有读写权限
2. 检查磁盘空间：确保有足够空间
3. 查看错误信息：脚本会输出详细的错误信息

### 如果需要手动添加映射：

编辑 `scripts/image_rename_mapping.json`：
```json
{
  "旧文件名": "新文件名",
  "另一个旧文件名": "另一个新文件名"
}
```

然后运行 `python3 scripts/rename_images.py` 应用映射。

